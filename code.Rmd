---
title: "Code_elab"
author: "AsheanAbeysinghe"
date: "8/5/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Accumulazione dei dati

Cominciamo le nostre analisi raccolgiendo i dati, importiamo i dati dai file csv in dei dataset



```{r}
library(readr)
library(dplyr)
library(ggplot2)
library(ggpubr)
library(tidyr)

prezzi_carne_dt = read_csv("Meat_prices.csv")
prezzi_carne_dt

emissioni_gaserra_dt = read_csv("owid-co2-data.csv")
emissioni_gaserra_dt

Food_America_Organization_dt = read_csv("FAO.csv")
Food_America_Organization_dt
```


## Ordinamento dei dati

Una volta preparati i vari dataset possiamo procedere con un ordinamento generale dei dati, notiamo però che 
generalmente i dataset usati sono già ordinati, consistenti ed uniformi.

##Quanta carne manfiamo nelle varie nazioni?
Creaimo un dataset da dataset met_consumption_worldwide mettento in rapporto la colonna relativa alla nazione, al consumo di carne e l' anno 2020.

<!-- # -->
<!-- #```{r pressure, echo=FALSE} -->


<!-- #consumi_manzo_2020 = consumi_carne_dt %>% -->
<!-- #  filter( TIME == 2020 , SUBJECT == "BEEF") -->
<!-- # -->
<!-- #media_consumi_manzo =  mean(dplyr::pull(consumi_manzo_2020, Value)) -->
<!-- # -->
<!-- #consumi_manzo_magg_2020 = consumi_manzo_2020 %>% -->
<!-- #  filter (Value > media_consumi_manzo) -->


<!--   ggplot(data = consumi_manzo_magg_2020, aes(x=LOCATION, y=Value, color=SUBJECT)) + -->
<!--   geom_bar(stat="identity") -->
<!-- ``` -->
<!-- ```{r pressure, echo=FALSE} -->


<!-- consumi_ovina_2020 = consumi_carne_dt %>% -->
<!--   filter( TIME == 2020 , SUBJECT == "SHEEP") -->

<!-- media_consumi_ovini =  mean(dplyr::pull(consumi_ovina_2020, Value)) -->

<!-- consumi_ovini_magg_2020 = consumi_ovina_2020 %>% -->
<!--   filter (Value > media_consumi_ovini) -->

<!-- ggplot(data = consumi_ovini_magg_2020, aes(x=LOCATION, y=Value, color=SUBJECT)) + -->
<!--   geom_bar(stat="identity") -->
<!-- ``` -->
<!-- ```{r pressure, echo=FALSE} -->


<!-- consumi_pollame_2020 = consumi_carne_dt %>% -->
<!--   filter( TIME == 2020 , SUBJECT == "POULTRY") -->

<!-- media_consumi_pollame =  mean(dplyr::pull(consumi_pollame_2020, Value)) -->

<!-- consumi_pollame_magg_2020 = consumi_pollame_2020 %>% -->
<!--   filter (Value > media_consumi_pollame) -->

<!-- ggplot(data = consumi_pollame_magg_2020, aes(x=LOCATION, y=Value, color=SUBJECT)) + -->
<!--   geom_bar(stat="identity") -->
<!-- ``` -->

Nel database fornito da FAO posso otterene quasi tutti i dati necessari per effettuare il progetto, 
partendo da qualcosa di semplice calcoliamo il quantitativo di carne prodotta a livello mondiale nel passare degli anni

i codici dei prodotti interessati sono (item code): 

 Manzo : 2731
 Carne Ovina : 2732
 Carne Suina : 2733
 Pollame : 2734
 altre carni : 2735
 
 
 Ed il campo relativo alle quantità che ci interessa relativo all' anno, dovremmo infatti sommare tutti i valori
 di Y1961 con i codici precedenti.
 
```{r}
 
 consumi_totali_carni = Food_America_Organization_dt %>%
                        select("Item Code", starts_with("Y"))  %>% 
                        filter(`Item Code` %in% c("2731","2732","2733","2734","2735"))
                       # replace(NA,0) %>%
                        #mutate(val_sum = colSums(consumi_totali_carni[,-1])) %>%
                        
                       
  

consumi_totali_carni[complete.cases(consumi_totali_carni), ] %>%
                       summarize_if(is.numeric, sum, na.rm = TRUE)

consumi_totali_carni

#
                        #aggregate(consumi_totali_carni[-1], consumi_totali_carni["Item Code"], sum, na.rm=TRUE)
 
 
 
 
 
```


**Procediamo dunque con uno studio per ogni codice**

Dichiariamo una funzione che ritorni un grafico geompoint in base al codice del prodotto 


```{r}

consumi_mondiali<-function(code, title){
  consumi_totali = consumi_totali_carni%>%
  filter(`Item Code` == code)%>%
   summarize_if(is.numeric, sum, na.rm = TRUE)


consumi_totali
  
somma = as.numeric(consumi_totali[,-1], fixed = TRUE, na.rm = T)
anni = as.numeric( sub("Y", "", (colnames(consumi_totali))[-(1)], fixed = TRUE))

new_obj_for_tot = data.frame(anni,somma)[-1,]

# 
  ggplot(data = new_obj_for_tot)+
    geom_point(mapping = aes(x =anni, y = somma))+
    ggtitle(title)
    
}
   
 
   #  lines(lowess(somma,anni), col="blue")
  
  # ggplot(data=new_obj_for_manzo + 
  # geom_hisgram(aes(x = anni, y =somma))
  
  # ggplot(new_obj_for_manzo, aes(anni, somma))+
  # geom_point(alpha = 1/10)+
  # coord_cartesian(ylim = c(min(somma),max(somma)))
  #   
               
```

**Consumo mondiale di manzo**
```{r}
consumi_mondiali("2731","Consumi Mondiali di Manzo")
```
**Consumo mondiale di carne ovina**
```{r}
consumi_mondiali("2732","Consumi Mondiali di Carne Ovina")
```
**Consumo mondiale di Carne Suina**
```{r}
consumi_mondiali("2733","Consumi Mondiali di Carne Suina")
```
**Consumo mondiale di pollame**
```{r}
consumi_mondiali("2734","Consumi Mondiali di Pollame")
```
**Consumo mondiale di Carni**
```{r}
consumi_mondiali("2735","Consumi Mondiali di Carni")
```

Provo dunque a mettere a confronto tutti i dati su un unico grafico, immaginiamo di sommare tutti i valori 
e vederli in modo simile ai grafici precedenti.

```{r}

consumi_totali_2 =  pivot_longer(data= consumi_totali_carni, cols = starts_with("Y"),  names_to = "year",
   values_to = "values",
   values_drop_na = TRUE) 
  ##mutate()

ggplot(data = consumi_totali_2, aes(x = year, y = values, group = "Item Code"))+
  geom_line()+
  geom_point()

```
